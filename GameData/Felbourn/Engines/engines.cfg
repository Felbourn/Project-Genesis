
@PART[*]:HAS[@MODULE[ModuleEngineConfigs]]:FOR[zAll]
{
    %ACTIONS
    {
        action = remove ModuleEngineConfigs
    }
	!MODULE[ModuleEngineConfigs],* {}
}

@PART[*]:HAS[@MODULE[ModuleEngines*]&#engine_thrust[*]]:AFTER[zAll]
{
    %ACTIONS
    {
        action = set new engine thrust
    }
    @MODULE[ModuleEngines*]
    {
        @name = ModuleEnginesFX
        @maxThrust = #$/engine_thrust$
        %isp_sl = #$/isp_v$
    }   
}

@PART[*]:HAS[@MODULE[ModuleEngines*]&@PLUME[*Lower*]]:AFTER[zAll]
{
    %ACTIONS
    {
        action = set lower stage isp SL
    }
    @MODULE[ModuleEngines*]
    {
        @isp_sl *= 0.9
    }
}

@PART[*]:HAS[@MODULE[ModuleEngines*]&@PLUME[*Hypergolic*]]:AFTER[zAll]
{
    %ACTIONS
    {
        action = set hypergolic isp SL
    }
    @MODULE[ModuleEngines*]
    {
        @isp_sl *= 0.8
    }
}

@PART[*]:HAS[@MODULE[ModuleEngines*]&@PLUME[*Solid*]]:AFTER[zAll]
{
    %ACTIONS
    {
        action = set solid thrust isp SL
    }
    @MODULE[ModuleEngines*]
    {
        @isp_sl *= 0.7
    }
}

@PART[*]:HAS[@MODULE[ModuleEngines*]&@PLUME[*Upper*]]:AFTER[zAll]
{
    %ACTIONS
    {
        action = set upper stage isp SL
    }
    @MODULE[ModuleEngines*]
    {
        @isp_sl *= 0.25
    }    
}

@PART[*]:HAS[@MODULE[ModuleEngines*]&@PLUME[*NTR*]]:AFTER[zAll]
{
    %ACTIONS
    {
        action = set NTR isp SL
    }
    @MODULE[ModuleEngines*]
    {
        @isp_sl *= 0.1
    }    
}

@PART[*]:HAS[@MODULE[ModuleEngines*]&@PLUME[Hydrolox*]]:AFTER[zAll]
{
    %ACTIONS
    {
        action = set Hydrolox stats
    }
    @MODULE[ModuleEngines*]
    {
        @PROPELLANT[LiquidFuel]
        {
            @name = LqdHydrogen
            @ratio = 1
            @ratio /= #$@RESOURCE_DEFINITION[LqdHydrogen]/density$
        }
        @PROPELLANT[Oxidizer]
        {
            @name = LqdOxygen
            @ratio = #$@MM_VARS/LqdOxygen2LqdHydrogen$
            @ratio /= #$@RESOURCE_DEFINITION[LqdOxygen]/density$
        }
    }
}

@PART[*]:HAS[@MODULE[ModuleEngines*]&@PLUME[Kerolox*]]:AFTER[zAll]
{
    %ACTIONS
    {
        action = set Kerolox fuels
    }
    @MODULE[ModuleEngines*]
    {
        @PROPELLANT[LiquidFuel]
        {
            @name = Kerosene
            @ratio = 1
            @ratio /= #$@RESOURCE_DEFINITION[Kerosene]/density$
        }
        @PROPELLANT[Oxidizer]
        {
            @name = LqdOxygen
            @ratio = #$@MM_VARS/LqdOxygen2Kerosene$
            @ratio /= #$@RESOURCE_DEFINITION[LqdOxygen]/density$
        }
    }
}

@PART[*]:HAS[@MODULE[ModuleEngines*]&@PLUME[Hypergolic*]]:AFTER[zAll]
{
    %ACTIONS
    {
        action = set Hypergolic stats
    }
    @MODULE[ModuleEngines*]
    {
        @PROPELLANT[LiquidFuel]
        {
            @name = UDMH
            @ratio = 1
            @ratio /= #$@RESOURCE_DEFINITION[UDMH]/density$
        }
        @PROPELLANT[Oxidizer]
        {
            @name = NTO
            @ratio = #$@MM_VARS/NTO2UDMH$
            @ratio /= #$@RESOURCE_DEFINITION[NTO]/density$
        }
    }    
}

@PART[*]:HAS[@MODULE[ModuleEngines*]&@PLUME[*]]:AFTER[zAll]
{
    %ACTIONS
    {
        action = set isp curve
    }
    @MODULE[ModuleEngines*]
    {
        @atmosphereCurve
        {           
            @key,0 = #0 $/isp_v$
            @key,1 = #1 $../isp_sl$
        }
    }
}

@PART[*]:HAS[@MODULE[ModuleEnginesFX],@PLUME[*]]:Final
{
    %ACTIONS
    {
        action = set FX plume effect name
    }
 	@MODULE[ModuleEnginesFX]
    {
        %powerEffectName = #$/PLUME/name$
    }
}

@PART[*]:HAS[@MODULE[ModuleEnginesRF],@PLUME[*]]:Final
{
    %ACTIONS
    {
        action = set RF plume effect name
    }
    @MODULE[ModuleEngineConfigs]
    {
        @CONFIG,*
        {
	        %powerEffectName = #$/PLUME/name$
        }
    }    
}
