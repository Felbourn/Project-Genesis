
@PART[*]:HAS[#CrewCapacity[*]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = remove crew capacity
	}
	!CrewCapacity = DELETE // nothing gets crew capacity unless I say so
}

@PART[*]:HAS[@CREW_VOLUME[*]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = add crew space calculator
	}
	CREW_VOLUME
	{
		name = Any
		crew = 0
	}
}

@PART[*]:HAS[@CREW_VOLUME[Sphere]]:AFTER[zPhase1Init]
{
	// V = 4/3 * π * r^3
	%ACTIONS
	{
		action = define crew capacity for 'sphere'
	}
	@CREW_VOLUME[Sphere]
	{
		crew = #$dia$
		@crew *= #$@MM_VARS/DiamToRadius$
		@crew != #$@MM_VARS/Cubed$
		@crew *= #$@MM_VARS/PI$
		@crew *= #$@MM_VARS/SphereRatio$
	}
	@CREW_VOLUME[Any]
	{
		@crew += #$/CREW_VOLUME[Sphere]/crew$
	}
}

@PART[*]:HAS[@CREW_VOLUME[Can]]:AFTER[zPhase1Init]
{
	// V = π * r^2 * h
	%ACTIONS
	{
		action = define crew capacity for 'can'
	}
	@CREW_VOLUME[Can]
	{
		crew = #$dia$
		@crew *= #$@MM_VARS/DiamToRadius$
		@crew != #$@MM_VARS/Squared$
		@crew *= #$@MM_VARS/PI$
		@crew *= #$hgt$
	}
	@CREW_VOLUME[Any]
	{
		@crew += #$/CREW_VOLUME[Can]/crew$
	}
}

// divide and then truncate to an integer to get the true crew capacity based on interior volume
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[*]]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = set CrewCapacity to 1, then incrment as needed
	}
	@CREW_VOLUME[Any]
	{
		@crew /= 5     // every 5 cubic meters of internal volume can have 1 crew
	}
	CrewCapacity = 1   // always room for 1 if we have decided there's any room at all
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>1.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>2.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>3.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>4.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>5.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>6.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>7.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>8.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>9.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>10.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>11.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>12.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>13.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>14.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>15.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>16.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>17.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>18.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>19.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
@PART[*]:HAS[@CREW_VOLUME[Any]:HAS[#crew[>20.5]]]:AFTER[zPhase1Init]
{
	@CrewCapacity += 1
}
