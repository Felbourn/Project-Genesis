
// run after everything else but before FINAL

@PART[*]:HAS[@MODULE[ModuleFuelTanks]]:AFTER[zAll]
{
	%ACTIONS
	{
		action = remove ModuleFuelTanks
	}
	!MODULE[ModuleFuelTanks],* {}
}

@PART[*]:HAS[#MFT_sphere[*]]:AFTER[zAll]
{
	%ACTIONS
	{
		action = add empty sphere ModuleFuelTanks
	}
	%MODULE[ModuleFuelTanks]
	{
		%type = Default
		%volume = 0
	}	
}

@PART[*]:HAS[#MFT_dia[*]]:AFTER[zAll]
{
	%ACTIONS
	{
		action = add empty cylinder ModuleFuelTanks
	}
	%MODULE[ModuleFuelTanks]
	{
		%type = Default
		%volume = 0
	}	
}

@PART[*]:HAS[#MFT_dia[*]]:AFTER[zAll]
{
	%ACTIONS
	{
		action = add cylinder ModuleFuelTanks
	}
	@MODULE[ModuleFuelTanks]
	{
		change = #$/MFT_dia$
		@change *= #$@MM_VARS/DiamToRadius$
		@change != #$@MM_VARS/Squared$
		@change *= #$@MM_VARS/PI$
		@change *= #$/MFT_hgt$
		@volume += #$change$
		!change = DELETE
	}
}

@PART[*]:HAS[#MFT_sphere[*]]:AFTER[zAll]
{
	%ACTIONS
	{
		action = add sphere ModuleFuelTanks
	}
	@MODULE[ModuleFuelTanks]
	{
		change = #$/MFT_sphere$
		@change *= #$@MM_VARS/DiamToRadius$
		@change != #$@MM_VARS/Cubed$
		@change *= #$@MM_VARS/PI$
		@change *= #$@MM_VARS/SphereRatio$
		@volume += #$change$
		!change = DELETE
	}
}

@PART[*]:HAS[@MODULE[ModuleFuelTanks]]:AFTER[zAll]
{
	%ACTIONS
	{
		action = finalize fuel tank volume
	}
	@MODULE[ModuleFuelTanks]
	{
		@volume *= #$@MM_VARS/LitersPerCM$
		@volume *= #$/MFT_util$
	}	
}

@PART[*]:HAS[@MODULE[ModuleFuelTanks]&#MFT_type[*]]:AFTER[zAll]
{
	%ACTIONS
	{
		action = change default fuel tank type
	}
	@MODULE[ModuleFuelTanks]
	{
		@type = #$/MFT_type$
	}
}
