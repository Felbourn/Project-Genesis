
@PART[*]:HAS[@MODULE[ModuleFuelTanks]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = remove ModuleFuelTanks
	}
	!MODULE[ModuleFuelTanks],* {}
}

@PART[*]:HAS[@MOD_TANK[*]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = add empty ModuleFuelTanks
	}
	@MOD_TANK,*:HAS[~type[]]
	{
		type = Default
	}
	MODULE
	{
		name = ModuleFuelTanks
		type = #$/MOD_TANK/type$
		volume = 0
	}
}

@PART[*]:HAS[@MOD_TANK[Pill]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = add pill ModuleFuelTanks
	}
	MOD_TANK
	{
		name = Can
		type = #$/MOD_TANK[Pill]/type$ 
		dia = #$/MOD_TANK[Pill]/dia$
		hgt = #$/MOD_TANK[Pill]/hgt$
		@hgt -= #$/MOD_TANK[Pill]/dia$
		util = #$/MOD_TANK[Pill]/util$
	}
	MOD_TANK
	{
		name = Globe
		type = #$/MOD_TANK[Pill]/type$ 
		dia = #$/MOD_TANK[Pill]/dia$
		util = #$/MOD_TANK[Pill]/util$
	}
}

@PART[*]:HAS[@MOD_TANK[Can]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = add cylinder ModuleFuelTanks
	}
	@MODULE[ModuleFuelTanks]
	{
		change = #$/MOD_TANK[Can]/dia$
		@change *= #$@MM_VARS/DiamToRadius$
		@change != #$@MM_VARS/Squared$
		@change *= #$@MM_VARS/PI$
		@change *= #$/MOD_TANK[Can]/hgt$
		@volume += #$change$
		!change = DELETE
	}
}

@PART[*]:HAS[@MOD_TANK[Globe]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = add sphere ModuleFuelTanks
	}
	@MODULE[ModuleFuelTanks]
	{
		change = #$/MOD_TANK[Globe]/dia$
		@change *= #$@MM_VARS/DiamToRadius$
		@change != #$@MM_VARS/Cubed$
		@change *= #$@MM_VARS/PI$
		@change *= #$@MM_VARS/SphereRatio$
		@volume += #$change$
		!change = DELETE
	}
}

@PART[*]:HAS[@MOD_TANK[Box]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = add sphere ModuleFuelTanks
	}
	@MODULE[ModuleFuelTanks]
	{
		change = #$/MOD_TANK[Box]/wid$
		@change *= #$/MOD_TANK[Box]/hgt$
		@change *= #$/MOD_TANK[Box]/dep$
		@volume += #$change$
		!change = DELETE
	}
}

@PART[*]:HAS[@MODULE[ModuleFuelTanks]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = finalize fuel tank volume
	}
	@MODULE[ModuleFuelTanks]
	{
		@volume *= #$@MM_VARS/LitersPerCM$
		@volume *= #$/MOD_TANK/util$
	}	
}
