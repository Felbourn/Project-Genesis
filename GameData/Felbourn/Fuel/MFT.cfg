
// run after everything else but before FINAL

@PART[*]:AFTER[zAll]
{
	!MODULE[ModuleFuelTanks] {}
}

@PART[*]:HAS[#MFT_dia[*]|#MFT_sphere[*]]:AFTER[zAll]
{
	MODULE
	{
		name = ModuleFuelTanks
		type = Default
		volume = 0
	}	
}

@PART[*]:HAS[#MFT_dia[*]]:AFTER[zAll]
{
	%ACTIONS
	{
		action = add cylinder ModuleFuelTanks
	}
	@MODULE[ModuleFuelTanks]
	{
		change = #$/MFT_dia$
		@change *= #$@MM_VARS/DiamToRadius$
		@change != #$@MM_VARS/Squared$
		@change *= #$@MM_VARS/PI$
		@change *= #$/MFT_hgt$
		@volume += #$change$
		!change = DELETE
	}
	@TechRequired = inProgress
}

@PART[*]:HAS[#MFT_sphere[*]]:AFTER[zAll]
{
	%ACTIONS
	{
		action = add sphere ModuleFuelTanks
	}
	@MODULE[ModuleFuelTanks]
	{
		change = #$/MFT_sphere$
		@change *= #$@MM_VARS/DiamToRadius$
		@change != #$@MM_VARS/Cubed$
		@change *= #$@MM_VARS/PI$
		@change *= #$@MM_VARS/SphereRatio$
		@volume += #$change$
		!change = DELETE
	}
	@TechRequired = inProgress
}

@PART[*]:HAS[@MODULE[ModuleFuelTanks]]:AFTER[zAll]
{
	@MODULE[ModuleFuelTanks]
	{
		@volume *= #$@MM_VARS/LitersPerCM$
		@volume *= #$/MFT_util$
	}	
}

@PART[*]:HAS[@MODULE[ModuleFuelTanks]&#MFT_type[*]]:AFTER[zAll]
{
	@MODULE[ModuleFuelTanks]
	{
		@type = #$/MFT_type$
	}
}
