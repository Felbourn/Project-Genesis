
@PART[*]:HAS[@MODULE[ModuleFuelTanks]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = remove ModuleFuelTanks
	}
	!MODULE[ModuleFuelTanks],* {}
}

@PART[*]:HAS[@FUEL_TANK[*]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = add empty ModuleFuelTanks
	}
	@FUEL_TANK,*:HAS[~type[]]
	{
		type = Default
	}
	MODULE
	{
		name = ModuleFuelTanks
		type = #$/FUEL_TANK/type$
		volume = 0
	}	
	%MODULE[ModuleCrossFeed] {}
}

@PART[*]:HAS[@FUEL_TANK[Pill]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = add pill ModuleFuelTanks
	}
	FUEL_TANK
	{
		name = Can
		type = #$/FUEL_TANK[Pill]/type$ 
		dia = #$/FUEL_TANK[Pill]/dia$
		hgt = #$/FUEL_TANK[Pill]/hgt$
		@hgt -= #$/FUEL_TANK[Pill]/dia$
		util = #$/FUEL_TANK[Pill]/util$
	}
	FUEL_TANK
	{
		name = Globe
		type = #$/FUEL_TANK[Pill]/type$ 
		dia = #$/FUEL_TANK[Pill]/dia$
		util = #$/FUEL_TANK[Pill]/util$
	}
}

@PART[*]:HAS[@FUEL_TANK[Can]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = add cylinder ModuleFuelTanks
	}
	@MODULE[ModuleFuelTanks]
	{
		change = #$/FUEL_TANK[Can]/dia$
		@change *= #$@MM_VARS/DiamToRadius$
		@change != #$@MM_VARS/Squared$
		@change *= #$@MM_VARS/PI$
		@change *= #$/FUEL_TANK[Can]/hgt$
		@volume += #$change$
		!change = DELETE
	}
}

@PART[*]:HAS[@FUEL_TANK[Globe]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = add sphere ModuleFuelTanks
	}
	@MODULE[ModuleFuelTanks]
	{
		change = #$/FUEL_TANK[Globe]/dia$
		@change *= #$@MM_VARS/DiamToRadius$
		@change != #$@MM_VARS/Cubed$
		@change *= #$@MM_VARS/PI$
		@change *= #$@MM_VARS/SphereRatio$
		@volume += #$change$
		!change = DELETE
	}
}

@PART[*]:HAS[@MODULE[ModuleFuelTanks]]:AFTER[zPhase1Init]
{
	%ACTIONS
	{
		action = finalize fuel tank volume
	}
	@MODULE[ModuleFuelTanks]
	{
		@volume *= #$@MM_VARS/LitersPerCM$
		@volume *= #$/FUEL_TANK/util$
	}	
}
