
@PART[*]:AFTER[zPhase3Command]
{
	!MODULE[ModuleCommand],* {}
	!MODULE[ModuleSAS],* {}
	!MODULE[ModuleSPU],* {}
    !MODULE[MechJebCore],* {}
}

@PART[*]:HAS[@VARS:HAS[#commandWatts[*]]]:AFTER[zPhase3Command]
{
	%ACTIONS
	{
		action = add command, SAS, & SPU
	}
	MODULE
	{
		name = ModuleCommand
		RESOURCE
		{
			name = ElectricCharge
			rate = #$/VARS/commandWatts$
			@rate /= #$@MM_VARS/SecondsPerHour$
		}
	}
	MODULE
	{
		name = ModuleSAS
	}
	MODULE
	{
		name = ModuleSPU
	}
}

@PART[*]:HAS[@VARS:HAS[#commandWatts[*],~useMechJeb[false]]]:AFTER[zPhase3Command]
{
	%ACTIONS
	{
		action = add MJ core
	}
    MODULE
    {
    	name = MechJebCore
    	blacklist = MechJebModuleAscentAutopilot
    	@blacklist ^= :$: MechJebModuleAscentGuidance:
    	@blacklist ^= :$: MechJebModuleAscentPathEditor:
    	@blacklist ^= :$: MechJebModuleDockingAutopilot:
    	@blacklist ^= :$: MechJebModuleDockingGuidance:
   		@blacklist ^= :$: MechJebModuleLandingAutopilot:
    	@blacklist ^= :$: MechJebModuleRendezvousAutopilot:
    	@blacklist ^= :$: MechJebModuleRendezvousAutopilotWindow:
    	@blacklist ^= :$: MechJebModuleRoverController:
    	@blacklist ^= :$: MechJebModuleRoverWindow:
    	@blacklist ^= :$: MechJebModuleSpaceplaneAutopilot:
    	@blacklist ^= :$: MechJebModuleSpaceplaneGuidance:

        RESOURCE
        {
        	name = ElectricCharge
            rate = 0.001
        }
    }	
}

@PART[*]:HAS[@VARS:HAS[#batteryBackup[*]]]:AFTER[zPhase3Command]
{
	%ACTIONS
	{
		action = add CPU backup battery
	}
	RESOURCE
	{
		name = ElectricCharge
		amount = #$/VARS/commandWatts$
		@amount *= #$/VARS/batteryBackup$
		maxAmount = #$amount$
	}
}
